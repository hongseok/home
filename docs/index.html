<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOME</title>
  </head>
  <body>
      <h2>UniversalLink / AppLink Test</h2>
      <h3>Params</h3>
      <ul id="params"></ul>
      <a href="https://link.porthej.com" id="link">광고주 App/Web으로 이동</a>
      <a href="https://hasher.porthej.com?param=test123abc" id="link2">Hasher App으로 이동</a>

      <hr />
      <h3>Received Params</h3>
      <ul id="received"></ul>
    <script type="text/javascript">

        function makeCID() {
            return 'xxxxxxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        window.onload = function() {
            const timestamp = Math.floor(+ new Date() / 1000);
            const clickId = makeCID();

            var ul = document.getElementById("params")

            var liTS = document.createElement("li");
            liTS.appendChild(document.createTextNode("timestamp = " + timestamp));
            ul.appendChild(liTS);

            var liCID = document.createElement("li");
            liCID.appendChild(document.createTextNode("clickID = " + clickId));
            ul.appendChild(liCID);

            const linkStr = "https://link.porthej.com?ts=" + timestamp + "&cid=" + clickId;
            document.getElementById("link").href = linkStr

            // Received Parameters
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has("cid")) {
                var ul = document.getElementById("received")
                urlParams.forEach(function(value, key) {
                    var li = document.createElement("li");
                    var text = document.createTextNode(key + " = " + value);
                    li.appendChild(text);
                    ul.appendChild(li);
                })
            }

      }
    </script>
  </body>
</html>
